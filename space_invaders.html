<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>Space Invaders</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            color: #00FF00;
            font-family: 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        
        #gameContainer {
            border: 2px solid #00FF00;
            position: relative;
            max-width: 100vw;
            max-height: 100vh;
        }
        
        canvas {
            display: block;
            background: #000;
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        #gameUI {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #00FF00;
            font-size: 18px;
            z-index: 10;
        }
        
        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #FF0000;
            font-size: 24px;
            display: none;
            z-index: 20;
        }
        
        #instructions {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            color: #00FF00;
            font-size: 14px;
        }
        
        #mobileControls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 120px;
            display: none;
            background: rgba(0, 0, 0, 0.8);
            z-index: 30;
        }
        
        .control-btn {
            position: absolute;
            width: 60px;
            height: 60px;
            border: 2px solid #00FF00;
            background: rgba(0, 255, 0, 0.1);
            color: #00FF00;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }
        
        .control-btn:active {
            background: rgba(0, 255, 0, 0.3);
        }
        
        #leftBtn {
            left: 20px;
            bottom: 30px;
        }
        
        #rightBtn {
            left: 100px;
            bottom: 30px;
        }
        
        #shootBtn {
            right: 20px;
            bottom: 30px;
            width: 80px;
            height: 80px;
            font-size: 14px;
        }
        
        #pauseBtn {
            right: 20px;
            top: 20px;
            width: 50px;
            height: 50px;
            font-size: 12px;
        }
        
        #versionLabel {
            position: absolute;
            bottom: 10px;
            right: 10px;
            color: #00FF00;
            font-size: 12px;
            opacity: 0.7;
            z-index: 10;
        }
        
        @media (max-width: 768px) {
            #mobileControls {
                display: block;
            }
            
            #instructions {
                display: none;
            }
            
            #versionLabel {
                bottom: 130px;
            }
            
            #gameContainer {
                border: none;
            }
            
            canvas {
                width: 100vw;
                height: calc(100vh - 120px);
            }
        }
        
        @media (orientation: landscape) and (max-height: 500px) {
            #mobileControls {
                height: 80px;
            }
            
            .control-btn {
                width: 50px;
                height: 50px;
                font-size: 14px;
            }
            
            #shootBtn {
                width: 60px;
                height: 60px;
            }
            
            canvas {
                height: calc(100vh - 80px);
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        <div id="gameUI">
            <div>Score: <span id="score">0</span></div>
            <div>Lives: <span id="lives">3</span></div>
            <div>Level: <span id="level">1</span></div>
        </div>
        <div id="gameOver">
            <div>GAME OVER</div>
            <div>Press SPACE to restart</div>
        </div>
        <div id="instructions">
            Use ← → arrows to move • SPACE to shoot • ESC to pause
        </div>
        
        <div id="mobileControls">
            <div id="leftBtn" class="control-btn">←</div>
            <div id="rightBtn" class="control-btn">→</div>
            <div id="shootBtn" class="control-btn">FIRE</div>
        </div>
        
        <div id="pauseBtn" class="control-btn">⏸</div>
        
        <div id="versionLabel">v2.0 Mobile</div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Mobile detection and setup
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        let canvasScale = 1;
        
        function setupCanvas() {
            if (isMobile) {
                const container = document.getElementById('gameContainer');
                const mobileControls = document.getElementById('mobileControls');
                const controlHeight = window.innerHeight <= 500 ? 80 : 120;
                
                canvas.style.width = '100vw';
                canvas.style.height = `calc(100vh - ${controlHeight}px)`;
                
                // Calculate scale for touch coordinates
                const rect = canvas.getBoundingClientRect();
                canvasScale = canvas.width / rect.width;
            }
        }
        
        // Touch handling variables
        let touchState = {
            left: false,
            right: false,
            shoot: false
        };
        
        // Game constants
        const GAME_WIDTH = canvas.width;
        const GAME_HEIGHT = canvas.height;
        const PLAYER_SPEED = 5;
        const BULLET_SPEED = 7;
        const INVADER_SPEED = 1;
        const INVADER_DROP_SPEED = 20;
        
        // Game state
        let gameState = {
            player: null,
            bullets: [],
            invaders: [],
            invaderBullets: [],
            barriers: [],
            particles: [],
            score: 0,
            lives: 3,
            level: 1,
            isGameOver: false,
            isPaused: false,
            invaderDirection: 1,
            invaderDropTimer: 0,
            shootCooldown: 0,
            invaderShootTimer: 0
        };
        
        // Input handling
        const keys = {};
        
        // Player class
        class Player {
            constructor() {
                this.x = GAME_WIDTH / 2 - 15;
                this.y = GAME_HEIGHT - 50;
                this.width = 30;
                this.height = 20;
                this.speed = PLAYER_SPEED;
            }
            
            update() {
                if (keys['ArrowLeft'] && this.x > 0) {
                    this.x -= this.speed;
                }
                if (keys['ArrowRight'] && this.x < GAME_WIDTH - this.width) {
                    this.x += this.speed;
                }
                
                if (keys[' '] && gameState.shootCooldown <= 0) {
                    this.shoot();
                    gameState.shootCooldown = 15;
                }
                
                if (gameState.shootCooldown > 0) {
                    gameState.shootCooldown--;
                }
            }
            
            shoot() {
                gameState.bullets.push(new Bullet(
                    this.x + this.width / 2 - 2,
                    this.y,
                    -BULLET_SPEED,
                    '#00FF00'
                ));
            }
            
            draw() {
                // Draw classic player ship with better visibility
                ctx.fillStyle = '#00FF00';
                
                // Main triangular body
                ctx.beginPath();
                ctx.moveTo(this.x + this.width / 2, this.y);
                ctx.lineTo(this.x, this.y + this.height);
                ctx.lineTo(this.x + this.width, this.y + this.height);
                ctx.closePath();
                ctx.fill();
                
                // Add a base rectangle for stability
                ctx.fillRect(this.x + 5, this.y + this.height - 5, this.width - 10, 5);
                
                // Add wing details
                ctx.fillRect(this.x, this.y + this.height - 8, 8, 3);
                ctx.fillRect(this.x + this.width - 8, this.y + this.height - 8, 8, 3);
            }
        }
        
        // Bullet class
        class Bullet {
            constructor(x, y, speed, color = '#00FF00') {
                this.x = x;
                this.y = y;
                this.speed = speed;
                this.color = color;
                this.width = 4;
                this.height = 8;
            }
            
            update() {
                this.y += this.speed;
                return this.y > -10 && this.y < GAME_HEIGHT + 10;
            }
            
            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
            }
        }
        
        // Invader class
        class Invader {
            constructor(x, y, type = 0) {
                this.x = x;
                this.y = y;
                this.width = 30;
                this.height = 20;
                this.type = type;
                this.animFrame = 0;
                this.animTimer = 0;
                this.points = [40, 20, 10][type] || 10;
            }
            
            update() {
                this.animTimer++;
                if (this.animTimer >= 30) {
                    this.animFrame = 1 - this.animFrame;
                    this.animTimer = 0;
                }
                
                // Random shooting
                if (Math.random() < 0.0005) {
                    this.shoot();
                }
            }
            
            shoot() {
                gameState.invaderBullets.push(new Bullet(
                    this.x + this.width / 2 - 2,
                    this.y + this.height,
                    3,
                    '#FF0000'
                ));
            }
            
            draw() {
                ctx.fillStyle = ['#FF00FF', '#00FFFF', '#FFFF00'][this.type] || '#FFFF00';
                
                const frame = this.animFrame;
                
                if (this.type === 0) { // Top row - octopus
                    this.drawOctopus(frame);
                } else if (this.type === 1) { // Middle row - crab
                    this.drawCrab(frame);
                } else { // Bottom row - squid
                    this.drawSquid(frame);
                }
            }
            
            drawOctopus(frame) {
                const x = this.x;
                const y = this.y;
                
                // Body
                ctx.fillRect(x + 8, y + 4, 14, 8);
                ctx.fillRect(x + 6, y + 6, 18, 4);
                
                // Eyes
                ctx.fillRect(x + 9, y + 6, 2, 2);
                ctx.fillRect(x + 19, y + 6, 2, 2);
                
                // Tentacles (animated)
                if (frame === 0) {
                    ctx.fillRect(x + 2, y + 12, 2, 4);
                    ctx.fillRect(x + 8, y + 12, 2, 6);
                    ctx.fillRect(x + 14, y + 12, 2, 4);
                    ctx.fillRect(x + 20, y + 12, 2, 6);
                    ctx.fillRect(x + 26, y + 12, 2, 4);
                } else {
                    ctx.fillRect(x + 4, y + 12, 2, 6);
                    ctx.fillRect(x + 10, y + 12, 2, 4);
                    ctx.fillRect(x + 16, y + 12, 2, 6);
                    ctx.fillRect(x + 22, y + 12, 2, 4);
                    ctx.fillRect(x + 24, y + 12, 2, 6);
                }
            }
            
            drawCrab(frame) {
                const x = this.x;
                const y = this.y;
                
                // Body
                ctx.fillRect(x + 6, y + 8, 18, 6);
                ctx.fillRect(x + 4, y + 10, 22, 2);
                
                // Eyes
                ctx.fillRect(x + 8, y + 6, 2, 4);
                ctx.fillRect(x + 20, y + 6, 2, 4);
                
                // Claws (animated)
                if (frame === 0) {
                    ctx.fillRect(x, y + 8, 4, 2);
                    ctx.fillRect(x + 26, y + 8, 4, 2);
                    ctx.fillRect(x + 8, y + 14, 2, 4);
                    ctx.fillRect(x + 20, y + 14, 2, 4);
                } else {
                    ctx.fillRect(x + 2, y + 6, 4, 2);
                    ctx.fillRect(x + 24, y + 6, 4, 2);
                    ctx.fillRect(x + 10, y + 14, 2, 4);
                    ctx.fillRect(x + 18, y + 14, 2, 4);
                }
            }
            
            drawSquid(frame) {
                const x = this.x;
                const y = this.y;
                
                // Body
                ctx.fillRect(x + 8, y + 6, 14, 8);
                
                // Eyes
                ctx.fillRect(x + 10, y + 8, 2, 2);
                ctx.fillRect(x + 18, y + 8, 2, 2);
                
                // Legs (animated)
                if (frame === 0) {
                    ctx.fillRect(x + 6, y + 14, 2, 4);
                    ctx.fillRect(x + 10, y + 14, 2, 2);
                    ctx.fillRect(x + 14, y + 14, 2, 4);
                    ctx.fillRect(x + 18, y + 14, 2, 2);
                    ctx.fillRect(x + 22, y + 14, 2, 4);
                } else {
                    ctx.fillRect(x + 8, y + 14, 2, 2);
                    ctx.fillRect(x + 12, y + 14, 2, 4);
                    ctx.fillRect(x + 16, y + 14, 2, 2);
                    ctx.fillRect(x + 20, y + 14, 2, 4);
                }
            }
        }
        
        // Barrier class
        class Barrier {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.width = 60;
                this.height = 40;
                this.blocks = [];
                this.initBlocks();
            }
            
            initBlocks() {
                // Create barrier shape
                const pattern = [
                    "111111111111",
                    "111111111111",
                    "111111111111",
                    "111000000111",
                    "111000000111",
                    "100000000001"
                ];
                
                for (let row = 0; row < pattern.length; row++) {
                    this.blocks[row] = [];
                    for (let col = 0; col < pattern[row].length; col++) {
                        this.blocks[row][col] = pattern[row][col] === '1';
                    }
                }
            }
            
            checkCollision(bullet) {
                const relX = bullet.x - this.x;
                const relY = bullet.y - this.y;
                
                if (relX < 0 || relX >= this.width || relY < 0 || relY >= this.height) {
                    return false;
                }
                
                const blockX = Math.floor(relX / 5);
                const blockY = Math.floor(relY / 6.67);
                
                if (blockY >= 0 && blockY < this.blocks.length && 
                    blockX >= 0 && blockX < this.blocks[blockY].length) {
                    
                    if (this.blocks[blockY][blockX]) {
                        // Destroy block
                        this.blocks[blockY][blockX] = false;
                        return true;
                    }
                }
                return false;
            }
            
            draw() {
                ctx.fillStyle = '#00FF00';
                for (let row = 0; row < this.blocks.length; row++) {
                    for (let col = 0; col < this.blocks[row].length; col++) {
                        if (this.blocks[row][col]) {
                            ctx.fillRect(
                                this.x + col * 5,
                                this.y + row * 6.67,
                                5,
                                6.67
                            );
                        }
                    }
                }
            }
        }
        
        // Particle effect
        class Particle {
            constructor(x, y, color = '#FFFF00') {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 4;
                this.vy = (Math.random() - 0.5) * 4;
                this.life = 30;
                this.maxLife = 30;
                this.color = color;
            }
            
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.life--;
                return this.life > 0;
            }
            
            draw() {
                ctx.globalAlpha = this.life / this.maxLife;
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, 2, 2);
                ctx.globalAlpha = 1;
            }
        }
        
        // Initialize game
        function initGame() {
            gameState.player = new Player();
            gameState.bullets = [];
            gameState.invaders = [];
            gameState.invaderBullets = [];
            gameState.barriers = [];
            gameState.particles = [];
            gameState.isGameOver = false;
            gameState.isPaused = false;
            gameState.invaderDirection = 1;
            gameState.invaderDropTimer = 0;
            
            createInvaders();
            createBarriers();
            updateUI();
        }
        
        function createInvaders() {
            gameState.invaders = [];
            const startX = 100;
            const startY = 100;
            const spacingX = 50;
            const spacingY = 40;
            
            for (let row = 0; row < 5; row++) {
                for (let col = 0; col < 11; col++) {
                    const type = row < 1 ? 0 : row < 3 ? 1 : 2;
                    gameState.invaders.push(new Invader(
                        startX + col * spacingX,
                        startY + row * spacingY,
                        type
                    ));
                }
            }
        }
        
        function createBarriers() {
            gameState.barriers = [];
            const barrierCount = 4;
            const spacing = GAME_WIDTH / (barrierCount + 1);
            
            for (let i = 0; i < barrierCount; i++) {
                gameState.barriers.push(new Barrier(
                    spacing * (i + 1) - 30,
                    GAME_HEIGHT - 200
                ));
            }
        }
        
        function nextLevel() {
            gameState.level++;
            createInvaders();
            
            // Increase difficulty
            for (const invader of gameState.invaders) {
                invader.y += 20;
            }
        }
        
        function checkCollisions() {
            // Player bullets vs invaders
            for (let i = gameState.bullets.length - 1; i >= 0; i--) {
                const bullet = gameState.bullets[i];
                
                for (let j = gameState.invaders.length - 1; j >= 0; j--) {
                    const invader = gameState.invaders[j];
                    
                    if (bullet.x < invader.x + invader.width &&
                        bullet.x + bullet.width > invader.x &&
                        bullet.y < invader.y + invader.height &&
                        bullet.y + bullet.height > invader.y) {
                        
                        // Create explosion particles
                        for (let k = 0; k < 8; k++) {
                            gameState.particles.push(new Particle(
                                invader.x + invader.width / 2,
                                invader.y + invader.height / 2,
                                '#FFFF00'
                            ));
                        }
                        
                        gameState.score += invader.points;
                        gameState.bullets.splice(i, 1);
                        gameState.invaders.splice(j, 1);
                        updateUI();
                        break;
                    }
                }
            }
            
            // Invader bullets vs player
            for (let i = gameState.invaderBullets.length - 1; i >= 0; i--) {
                const bullet = gameState.invaderBullets[i];
                
                if (bullet.x < gameState.player.x + gameState.player.width &&
                    bullet.x + bullet.width > gameState.player.x &&
                    bullet.y < gameState.player.y + gameState.player.height &&
                    bullet.y + bullet.height > gameState.player.y) {
                    
                    gameState.invaderBullets.splice(i, 1);
                    gameState.lives--;
                    updateUI();
                    
                    if (gameState.lives <= 0) {
                        gameOver();
                    }
                    break;
                }
            }
            
            // Bullets vs barriers
            for (const barrier of gameState.barriers) {
                for (let i = gameState.bullets.length - 1; i >= 0; i--) {
                    if (barrier.checkCollision(gameState.bullets[i])) {
                        gameState.bullets.splice(i, 1);
                    }
                }
                
                for (let i = gameState.invaderBullets.length - 1; i >= 0; i--) {
                    if (barrier.checkCollision(gameState.invaderBullets[i])) {
                        gameState.invaderBullets.splice(i, 1);
                    }
                }
            }
            
            // Invaders reaching bottom
            for (const invader of gameState.invaders) {
                if (invader.y + invader.height > gameState.player.y) {
                    gameOver();
                    break;
                }
            }
        }
        
        function updateInvaders() {
            let shouldDrop = false;
            
            for (const invader of gameState.invaders) {
                invader.update();
                
                if (gameState.invaderDirection > 0 && invader.x + invader.width > GAME_WIDTH - 20) {
                    shouldDrop = true;
                } else if (gameState.invaderDirection < 0 && invader.x < 20) {
                    shouldDrop = true;
                }
            }
            
            if (shouldDrop) {
                gameState.invaderDirection *= -1;
                for (const invader of gameState.invaders) {
                    invader.y += INVADER_DROP_SPEED;
                }
            } else {
                for (const invader of gameState.invaders) {
                    invader.x += gameState.invaderDirection * INVADER_SPEED;
                }
            }
        }
        
        function gameOver() {
            gameState.isGameOver = true;
            document.getElementById('gameOver').style.display = 'block';
        }
        
        function resetGame() {
            gameState.score = 0;
            gameState.lives = 3;
            gameState.level = 1;
            document.getElementById('gameOver').style.display = 'none';
            initGame();
        }
        
        function updateUI() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('lives').textContent = gameState.lives;
            document.getElementById('level').textContent = gameState.level;
        }
        
        // Game loop
        function gameLoop() {
            if (!gameState.isPaused && !gameState.isGameOver) {
                // Update
                gameState.player.update();
                
                // Update bullets
                gameState.bullets = gameState.bullets.filter(bullet => bullet.update());
                gameState.invaderBullets = gameState.invaderBullets.filter(bullet => bullet.update());
                
                // Update invaders
                updateInvaders();
                
                // Update particles
                gameState.particles = gameState.particles.filter(particle => particle.update());
                
                // Check collisions
                checkCollisions();
                
                // Check win condition
                if (gameState.invaders.length === 0) {
                    nextLevel();
                }
            }
            
            // Draw
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
            
            if (!gameState.isGameOver) {
                gameState.player.draw();
            }
            
            gameState.bullets.forEach(bullet => bullet.draw());
            gameState.invaderBullets.forEach(bullet => bullet.draw());
            gameState.invaders.forEach(invader => invader.draw());
            gameState.barriers.forEach(barrier => barrier.draw());
            gameState.particles.forEach(particle => particle.draw());
            
            // Draw pause overlay
            if (gameState.isPaused) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
                ctx.fillStyle = '#00FF00';
                ctx.font = '48px Courier New';
                ctx.textAlign = 'center';
                ctx.fillText('PAUSED', GAME_WIDTH / 2, GAME_HEIGHT / 2);
                ctx.textAlign = 'left';
            }
            
            requestAnimationFrame(gameLoop);
        }
        
        // Event listeners
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            
            if (e.key === 'Escape') {
                gameState.isPaused = !gameState.isPaused;
            }
            
            if (e.key === ' ' && gameState.isGameOver) {
                resetGame();
            }
            
            e.preventDefault();
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });
        
        // Mobile touch controls
        function setupMobileControls() {
            const leftBtn = document.getElementById('leftBtn');
            const rightBtn = document.getElementById('rightBtn');
            const shootBtn = document.getElementById('shootBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            
            // Left button
            leftBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                touchState.left = true;
                keys['ArrowLeft'] = true;
            });
            
            leftBtn.addEventListener('touchend', (e) => {
                e.preventDefault();
                touchState.left = false;
                keys['ArrowLeft'] = false;
            });
            
            // Right button
            rightBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                touchState.right = true;
                keys['ArrowRight'] = true;
            });
            
            rightBtn.addEventListener('touchend', (e) => {
                e.preventDefault();
                touchState.right = false;
                keys['ArrowRight'] = false;
            });
            
            // Shoot button
            shootBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                touchState.shoot = true;
                keys[' '] = true;
                if (gameState.isGameOver) {
                    resetGame();
                }
            });
            
            shootBtn.addEventListener('touchend', (e) => {
                e.preventDefault();
                touchState.shoot = false;
                keys[' '] = false;
            });
            
            // Pause button
            pauseBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                gameState.isPaused = !gameState.isPaused;
            });
            
            // Prevent context menu on long press
            [leftBtn, rightBtn, shootBtn, pauseBtn].forEach(btn => {
                btn.addEventListener('contextmenu', (e) => e.preventDefault());
            });
        }
        
        // Handle window resize
        window.addEventListener('resize', () => {
            setupCanvas();
        });
        
        // Prevent scroll on touch
        document.addEventListener('touchmove', (e) => {
            e.preventDefault();
        }, { passive: false });
        
        // Initialize and start game
        setupCanvas();
        setupMobileControls();
        initGame();
        gameLoop();
    </script>
</body>
</html>